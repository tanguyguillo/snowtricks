{% extends 'base.html.twig' %}

{% set route = '' %}
{% set routeTitre = '' %}
{% set route = app.request.attributes.get('_route') %}

{% if route == 'tricks_details' %}
{% set routeTitre = 'Trick details' %}
{% endif %}

{% if route == 'tricks_modifications' %}
{% set routeTitre = 'modifications' %}
{% endif %}

{# titre #}
{% block title %}
Snowtricks - {{ routeTitre }} - {{ trick.title }}
{% endblock %}

{% block main %}
<br><br><br>
<div class="container text-center">
    <br>
    <br>
    <br>

    {# to test
    <pre>
        {{ app.request.attributes.get('_route') }}
        {{ route }}
    </pre> #}

    <span class="badge bg-primary">Snowtricks - {{ routeTitre }} </span>

    <div class="row justify-content-center" id="#tricks">
        <div class="col-lg-12">
            <div class="modifications">
                <div class="rounded shadow p-3 mb-5 bg-white">

                    {% if is_granted('IS_AUTHENTICATED_REMEMBERED') and app.request.attributes.get('_route') ==
                    "tricks_modifications" %}
                    <span>
                        <a href="#tricksDelete" class="float-right ml-1">
                            <i class="bi bi-trash-fill iconTricks"></i>
                        </a>
                        <a href="#" class="float-right ml-1" alt="update trick">
                            <i class="bi bi-pencil-fill iconTricks"></i>
                        </a>
                    </span>
                    {% endif %}

                    {# main picture #}
                    <img class="bd-placeholder-img bd-placeholder-img-lg img-fluid " width="100%" height="150"
                        src="{{ app.request.getSchemeAndHttpHost()}}/assets/img/tricks/{{ trick.picture }}"
                        alt="{{ trick.title }}">


                    {% if is_granted('IS_AUTHENTICATED_REMEMBERED') and app.request.attributes.get('_route') ==
                    "tricks_modifications" %}

                    {{ form_start(formUpdateTrick) }}


                    <div class="card-body">
                        {# trick name modification modification#}
                        <div class="container text-center">
                            <div class="row">
                                <div class="form-group">
                                    {{ form_row(formUpdateTrick.title, {
                                    label: 'Update this trick name',
                                    attr : {'class': 'form-control smallForForm'}
                                    }) }}
                                </div>
                            </div>
                        </div>

                        {# additionnal picture #}
                        {% if is_granted('IS_AUTHENTICATED_REMEMBERED') and
                        app.request.attributes.get('_route') == "tricks_modifications" %}

                        {{ form_row(formUpdateTrick.pictures, {
                        label: 'Add more additionnal pictures',
                        attr : {'class': 'form-control'}
                        }) }}
                        {% endif %}

                        {# infos #}
                        <ul class="list-inline">
                            <li class="list-inline-item">
                                Created by : {{ Author.username }}
                            </li class="list-inline-item"> |
                            <li class="list-inline-item">
                                Created at : {{ trick.createdAt|date('d-m-Y') }}
                            </li> |
                            {% if trick.modifiedAt != null %}
                            <li class="list-inline-item">
                                Updated at : {{ trick.modifiedAt|date('d-m-Y') }}
                            </li> |
                            {% endif %}
                            <li class="list-inline-item">
                                Groupe : {{ trick.category }}
                            </li>
                            {# content #}
                            <li>
                                {% if is_granted('IS_AUTHENTICATED_REMEMBERED') and
                                app.request.attributes.get('_route') == "tricks_modifications" %}
                                <input type="hidden" name="_token" value="{{ csrf_token('update' ~ trick.id) }}">
                                {{ form_row(formUpdateTrick.content, {
                                label: ' ',
                                attr : {'class': 'form-control'}
                                }) }}
                                {% else %}
                                {{ trick.content }}
                                {% endif %}
                            </li>
                        </ul>
                    </div>{# end of <div class="card-body"></div> #}


                    {# group/category #}
                    <div class="container text-center">
                        <div class="row">
                            <div class="col-4">
                                {% if is_granted('IS_AUTHENTICATED_REMEMBERED') and
                                app.request.attributes.get('_route') == "tricks_modifications" %}
                                {{ form_row(formUpdateTrick.category, {
                                label: 'Groups',
                                attr : {'class': 'form-control'}
                                }) }}
                                {% endif %}
                            </div>
                        </div>

                        {# submit #}
                        <div class="col-2 float-right ml-1">
                            <button class="btn btn-info updateTrick" type="submit">Save</button>
                        </div>
                        {{ form_end(formUpdateTrick) }}

                        <div class="col-2 float-right ml-1">
                            <form method="post"
                                action="{{ path('tricks_app_tricks_delete_from_detail', {'id': trick.id}) }}"
                                onsubmit="return confirm('Are you sure you want to delete this trick?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ trick.id) }}">
                                <button class="btn btn-danger">Delete</button>
                            </form>
                        </div>



                    </div>
                </div>


                <br>
                <br>
                <br>
                <br>

                {% endif %}

            </div>

        </div>

        {# comments #}
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="comments">
                        <div class="avatar-commentcol-lg-2">
                            <img src="assets/img/avatars/avatar-252Ã—230.png" height="100px" />
                        </div>
                        <div class="comment-text col-lg-10">
                            <p>Verni domesticus quam animi filius suspensus ut quae potuit magistro
                                discerpti turbela
                                translationem timore egerat futurorum quondam imbres emendabat referente
                                quam rettulimus
                                crebriores angorem diu diu timore referente crebriores Constantinopolim
                                suspensus emendabat
                                timore supra Herculanus auctique diu diu egerat emendabat.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <br>
        <br>
        <br>
        <br>


        <div id="overlay"></div>

        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        {% endblock %}